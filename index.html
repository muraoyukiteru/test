<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>A4 White Canvas â€“ Free Web App</title>
  <style>
    :root {
      --ui-gap: 12px;
    }
    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic UI", "Meiryo", sans-serif;
      background: #f4f6f8;
      color: #111;
    }
    header {
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: saturate(180%) blur(8px);
      background: rgba(255, 255, 255, 0.85);
      border-bottom: 1px solid #e5e7eb;
    }
    .toolbar {
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      gap: var(--ui-gap);
      align-items: center;
      padding: 10px 16px;
      flex-wrap: wrap;
    }
    .toolbar > * { margin: 4px 0; }
    .btn {
      appearance: none;
      background: #111;
      color: #fff;
      border: none;
      padding: 10px 14px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: transform .04s ease, opacity .2s ease;
      user-select: none;
    }
    .btn.secondary { background: #e5e7eb; color: #111; }
    .btn:active { transform: translateY(1px); }
    .btn[aria-pressed="true"] { outline: 2px solid #2563eb; }

    .field {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
    }
    .field label { font-size: 12px; color: #374151; }

    main {
      max-width: 1100px;
      margin: 18px auto 60px;
      padding: 0 16px;
    }

    /* A4 portrait area: 210mm Ã— 297mm aspect ratio */
    .a4-wrap {
      display: grid;
      place-items: center;
    }
    .a4 {
      width: min(96vw, calc(96vh * (210 / 297)));
      aspect-ratio: 210 / 297;
      background: #ffffff; /* ç„¡è‰²(ç™½) */
      box-shadow: 0 10px 30px rgba(0,0,0,.08);
      border-radius: 6px;
      position: relative;
      overflow: hidden;
      touch-action: none; /* enable smooth drawing on touch */
    }
    canvas { width: 100%; height: 100%; display: block; }

    footer { text-align: center; color: #6b7280; font-size: 12px; padding: 24px; }
    .hint { color: #6b7280; font-size: 12px; margin-left: 8px; }
  </style>
</head>
<body>
  <header>
    <div class="toolbar" role="toolbar" aria-label="Drawing toolbar">
      <button id="penBtn" class="btn" aria-pressed="true" title="ãƒšãƒ³ (P)">âœï¸ ãƒšãƒ³</button>
      <button id="eraserBtn" class="btn secondary" aria-pressed="false" title="æ¶ˆã—ã‚´ãƒ  (E)">ğŸ©¹ æ¶ˆã—ã‚´ãƒ </button>

      <span class="field">
        <label for="color">è‰²</label>
        <input id="color" type="color" value="#111111" />
      </span>

      <span class="field">
        <label for="size">å¤ªã•</label>
        <input id="size" type="range" min="1" max="40" value="4" />
      </span>

      <button id="clearBtn" class="btn secondary" title="å…¨æ¶ˆå»">ğŸ—‘ï¸ å…¨æ¶ˆå»</button>
      <button id="downloadBtn" class="btn" title="PNGã§ä¿å­˜ (Ctrl/Cmd+S ç›¸å½“)">â¬‡ï¸ PNGä¿å­˜</button>
      <span class="hint">PC/ã‚¹ãƒãƒ›ã§åˆ©ç”¨å¯ãƒ»ç„¡æ–™ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°å¯ï¼ˆä¸‹è¨˜èª¬æ˜ï¼‰</span>
    </div>
  </header>

  <main>
    <div class="a4-wrap">
      <!-- å†…éƒ¨è§£åƒåº¦ã¯A4ã‚’é«˜ç²¾ç´°ã§æ‰±ãˆã‚‹ã‚ˆã†å¤§ãã‚ã«è¨­å®šï¼ˆ300DPIç›¸å½“ï¼‰ -->
      <div class="a4">
        <canvas id="board" width="2480" height="3508" aria-label="A4 drawing canvas"></canvas>
      </div>
    </div>
  </main>

  <footer>
    A4æ¯”ç‡ã®ç™½ã‚­ãƒ£ãƒ³ãƒã‚¹ä¸Šã§æç”»ã§ãã¾ã™ã€‚ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°æ‰‹é †ã¯æœ¬æ–‡æœ«å°¾ã®ã‚³ãƒ¡ãƒ³ãƒˆå‚ç…§ã€‚
  </footer>

  <script>
    // --- State ---
    const canvas = document.getElementById('board');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });

    // åˆæœŸç™½å¡—ã‚Š
    function fillWhiteBackground() {
      ctx.save();
      ctx.globalCompositeOperation = 'source-over';
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.restore();
    }
    fillWhiteBackground();

    let drawing = false;
    let erasing = false;
    let last = null; // {x,y}

    const penBtn = document.getElementById('penBtn');
    const eraserBtn = document.getElementById('eraserBtn');
    const color = document.getElementById('color');
    const size = document.getElementById('size');
    const clearBtn = document.getElementById('clearBtn');
    const downloadBtn = document.getElementById('downloadBtn');

    function setTool(mode) {
      erasing = (mode === 'eraser');
      penBtn.setAttribute('aria-pressed', String(!erasing));
      eraserBtn.setAttribute('aria-pressed', String(erasing));
      penBtn.classList.toggle('secondary', erasing);
      eraserBtn.classList.toggle('secondary', !erasing);
    }

    penBtn.addEventListener('click', () => setTool('pen'));
    eraserBtn.addEventListener('click', () => setTool('eraser'));

    // Pointer coords -> canvas coordsï¼ˆè¡¨ç¤ºå€ç‡ã«ä¾å­˜ã—ãªã„ï¼‰
    function getCanvasPos(evt) {
      const rect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      const x = (evt.clientX - rect.left) * scaleX;
      const y = (evt.clientY - rect.top) * scaleY;
      return { x, y };
    }

    function drawLine(a, b) {
      ctx.save();
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      ctx.lineWidth = parseFloat(size.value);

      if (erasing) {
        ctx.globalCompositeOperation = 'destination-out';
        ctx.strokeStyle = 'rgba(0,0,0,1)';
      } else {
        ctx.globalCompositeOperation = 'source-over';
        ctx.strokeStyle = color.value;
      }

      ctx.beginPath();
      ctx.moveTo(a.x, a.y);
      ctx.lineTo(b.x, b.y);
      ctx.stroke();
      ctx.restore();
    }

    function pointerDown(e) {
      e.preventDefault();
      canvas.setPointerCapture(e.pointerId);
      drawing = true;
      last = getCanvasPos(e);
    }

    function pointerMove(e) {
      if (!drawing) return;
      const p = getCanvasPos(e);
      drawLine(last, p);
      last = p;
    }

    function pointerUp(e) {
      if (!drawing) return;
      drawing = false;
      canvas.releasePointerCapture(e.pointerId);
    }

    canvas.addEventListener('pointerdown', pointerDown);
    canvas.addEventListener('pointermove', pointerMove);
    canvas.addEventListener('pointerup', pointerUp);
    canvas.addEventListener('pointercancel', pointerUp);
    canvas.addEventListener('pointerleave', pointerUp);

    // Keyboard shortcuts
    window.addEventListener('keydown', (e) => {
      if (e.key.toLowerCase() === 'p') setTool('pen');
      if (e.key.toLowerCase() === 'e') setTool('eraser');
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') {
        e.preventDefault();
        downloadPNG();
      }
    });

    // Clear
    clearBtn.addEventListener('click', () => {
      const ok = confirm('ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’å…¨ã¦æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿ');
      if (ok) fillWhiteBackground();
    });

    // Download
    function downloadPNG() {
      const url = canvas.toDataURL('image/png');
      const a = document.createElement('a');
      const ts = new Date().toISOString().replaceAll(':','-').slice(0,19);
      a.href = url;
      a.download = `a4-canvas-${ts}.png`;
      document.body.appendChild(a);
      a.click();
      a.remove();
    }
    downloadBtn.addEventListener('click', downloadPNG);

    // Resize observer (optional hint overlay could go here)
    new ResizeObserver(() => {/* layout reactive; drawing is resolution-independent */}).observe(canvas);

    // --- Print support (A4) ---
    // ã“ã®ã¾ã¾å°åˆ·ã™ã‚‹ã¨A4ã§å‡ºåŠ›ã•ã‚Œã¾ã™ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®å°åˆ·è¨­å®šã¯ä½™ç™½ãªã—æ¨å¥¨ï¼‰
    const printStyle = document.createElement('style');
    printStyle.textContent = `
      @page { size: A4 portrait; margin: 0; }
      @media print {
        body { background: #fff; }
        header, footer { display: none; }
        .a4 { width: 210mm; height: 297mm; box-shadow: none; border-radius: 0; }
        canvas { width: 210mm; height: 297mm; }
      }
    `;
    document.head.appendChild(printStyle);

    // åˆå›ãƒ„ãƒ¼ãƒ«è¨­å®š
    setTool('pen');
  </script>

  <!--
  =============================
  ç„¡æ–™ã§å…¬é–‹ã™ã‚‹æ‰‹é †ï¼ˆä¾‹ï¼‰
  =============================
  â–  GitHub Pagesï¼ˆãŠã™ã™ã‚ï¼‰
    1) GitHubã§æ–°è¦ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆï¼ˆPublicï¼‰
    2) ä¸Šã® index.html ã‚’ãã®ã¾ã¾è¿½åŠ ãƒ»ã‚³ãƒŸãƒƒãƒˆ
    3) Settings â†’ Pages â†’ Build and deployment: Source = Deploy from a branch
       ãƒ»Branch: main / root ã‚’é¸æŠ
    4) æ•°åˆ†å¾…ã¤ã¨å…¬é–‹URLãŒç™ºè¡Œã•ã‚Œã€èª°ã§ã‚‚Webã‹ã‚‰åˆ©ç”¨ã§ãã¾ã™ã€‚

  â–  Netlify / Cloudflare Pages
    ãƒ»ç„¡æ–™ãƒ—ãƒ©ãƒ³ã§ãƒªãƒã‚¸ãƒˆãƒªã‚’æ¥ç¶šã™ã‚Œã°è‡ªå‹•ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¾ã™ã€‚

  â–  ãƒ­ãƒ¼ã‚«ãƒ«ã§è©¦ã™
    ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§ãƒ–ãƒ©ã‚¦ã‚¶è¡¨ç¤ºOKï¼ˆã‚µãƒ¼ãƒä¸è¦ï¼‰

  ã‚¹ãƒãƒ›ãƒ»PCä¸¡å¯¾å¿œï¼ˆã‚¿ãƒƒãƒ/ãƒã‚¦ã‚¹ï¼‰ã€‚
  èƒŒæ™¯ã¯ç´”ç™½(#fff)ã®A4æ¯”ç‡ã‚­ãƒ£ãƒ³ãƒã‚¹ã€‚PNGä¿å­˜ãƒ»å°åˆ·(A4)ã«å¯¾å¿œã€‚
  -->
</body>
</html>
